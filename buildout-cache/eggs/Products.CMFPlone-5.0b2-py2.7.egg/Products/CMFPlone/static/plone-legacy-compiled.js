(function(a){a.createReplyForm=function(b){var c=b.attr("id");var d=b.find(".reply-to-comment-button");var e=a("#commenting").clone(true);e.find("#formfield-form-widgets-captcha").find("script").remove();e.appendTo(b).css("display","none");e.removeAttr("id");a(d).css("display","none");var f=e.find("form");f.find('#formfield-form-widgets-comment-text').attr('id','formfield-form-widgets-new-textarea'+c);f.find('#form-widgets-comment-text').attr('id','form-widgets-new-textarea'+c);f.find("input[name='form.widgets.in_reply_to']").val(c);var g=e.find(".cancelreplytocomment");g.attr("id",c);f.find("input[name='form.buttons.cancel']").css("display","inline");e.slideDown("slow");g.css("display","inline");};a.clearForm=function(a){a.find(".error").removeClass("error");a.find(".fieldErrorBox").remove();a.find("input[type='text']").attr("value","");a.find("textarea").attr("value","");};a(window).load(function(){var b=a("#commenting");var c=b.find("input[name='form.widgets.in_reply_to']");if(c.length!==0&&c.val()!==""){var d="#"+c.val();var e=a(".discussion").find(d);a.createReplyForm(e);a.clearForm(b);}a(".reply-to-comment-button").bind("click",function(b){var c=a(this).parents().filter(".comment");a.createReplyForm(c);a.clearForm(c);});a("#commenting #form-buttons-cancel").bind("click",function(b){b.preventDefault();var c=a(this).parents().filter(".comment").find(".reply-to-comment-button");a.reply_to_comment_form=a(this).parents().filter(".reply");a.reply_to_comment_form.slideUp("slow",function(){a(this).remove();});c.css("display","inline");});a("input[name='form.button.PublishComment']").on('click',function(){var b=this;var c=a(this).parents("form");var d=a(c).serialize();var e=a(c).attr("action");a.ajax({type:"GET",url:e,data:d,context:b,success:function(a){c.find("input[name='form.button.PublishComment']").remove();c.parents(".state-pending").toggleClass('state-pending').toggleClass('state-published');},error:function(a){return true;}});return false;});a("form[name='edit']").prepOverlay({cssclass:'overlay-edit-comment',width:'60%',subtype:'ajax',filter:'#content>*'});a("input[name='form.button.DeleteComment']").on('click',function(){var b=this;var c=a(this).parents("form");var d=a(c).serialize();var e=a(c).attr("action");a.ajax({type:'POST',url:e,data:d,context:a(b).parents(".comment"),success:function(b){var c=a(this);var d=c.attr('class');var e=parseInt(d[d.indexOf('replyTreeLevel')+'replyTreeLevel'.length],10);var f=".replyTreeLevel"+e;for(var g=0;g<e;g++)f+=", .replyTreeLevel"+g;c.nextUntil(f).each(function(){a(this).fadeOut('fast',function(){a(this).remove();});});a(this).fadeOut('fast',function(){a(this).remove();});},error:function(a,b){return true;}});return false;});a(".reply").find("input[name='form.buttons.reply']").css("display","none");a(".reply").find("input[name='form.buttons.cancel']").css("display","none");a(".reply-to-comment-button").css("display","inline");});}(jQuery));!function(a){function b(b,e){var f,g,h,i=this,j=b.add(i),k=a(window),l=a.tools.expose&&(e.mask||e.expose),m=Math.random().toString().slice(10);l&&("string"==typeof l&&(l={color:l}),l.closeOnClick=l.closeOnEsc=!1);var n=e.target||b.attr("rel");if(g=n?a(n):null||b,!g.length)throw "Could not find Overlay: "+n;b&&-1==b.index(g)&&b.click(function(a){return i.load(a),a.preventDefault();}),a.extend(i,{load:function(b){if(i.isOpened())return i;var f=d[e.effect];if(!f)throw 'Overlay: cannot find effect : "'+e.effect+'"';if(e.oneInstance&&a.each(c,function(){this.close(b);}),b=b||a.Event(),b.type="onBeforeLoad",j.trigger(b),b.isDefaultPrevented())return i;h=!0,l&&a(g).expose(l);var n=e.top,o=e.left,p=g.outerWidth(!0),q=g.outerHeight(!0);return "string"==typeof n&&(n="center"==n?Math.max((k.height()-q)/2,0):parseInt(n,10)/100*k.height()),"center"==o&&(o=Math.max((k.width()-p)/2,0)),f[0].call(i,{top:n,left:o},function(){h&&(b.type="onLoad",j.trigger(b));}),l&&e.closeOnClick&&a.mask.getMask().one("click",i.close),e.closeOnClick&&a(document).on("click."+m,function(b){a(b.target).parents(g).length||i.close(b);}),e.closeOnEsc&&a(document).on("keydown."+m,function(a){27==a.keyCode&&i.close(a);}),i;},close:function(b){return i.isOpened()?(b=b||a.Event(),b.type="onBeforeClose",j.trigger(b),b.isDefaultPrevented()?void 0:(h=!1,d[e.effect][1].call(i,function(){b.type="onClose",j.trigger(b);}),a(document).off("click."+m+" keydown."+m),l&&a.mask.close(),i)):i;},getOverlay:function(){return g;},getTrigger:function(){return b;},getClosers:function(){return f;},isOpened:function(){return h;},getConf:function(){return e;}}),a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(b,c){a.isFunction(e[c])&&a(i).on(c,e[c]),i[c]=function(b){return b&&a(i).on(c,b),i;};}),f=g.find(e.close||".close"),f.length||e.close||(f=a('<a class="close"></a>'),g.prepend(f)),f.click(function(a){i.close(a);}),e.load&&i.load();}a.tools=a.tools||{version:"@VERSION"},a.tools.overlay={addEffect:function(a,b,c){d[a]=[b,c];},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!/msie/.test(navigator.userAgent.toLowerCase())||navigator.appVersion>6,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var c=[],d={};a.tools.overlay.addEffect("default",function(b,c){var d=this.getConf(),e=a(window);d.fixed||(b.top+=e.scrollTop(),b.left+=e.scrollLeft()),b.position=d.fixed?"fixed":"absolute",this.getOverlay().css(b).fadeIn(d.speed,c);},function(a){this.getOverlay().fadeOut(this.getConf().closeSpeed,a);}),a.fn.overlay=function(d){var e=this.data("overlay");return e?e:(a.isFunction(d)&&(d={onBeforeLoad:d}),d=a.extend(!0,{},a.tools.overlay.conf,d),this.each(function(){e=new b(a(this),d),c.push(e),a(this).data("overlay",e);}),d.api?e:this);};}(jQuery),function(a){function b(b,c){var d=a(c);return d.length<2?d:b.parent().find(c);}function c(c,e){var f=this,g=c.add(f),h=c.children(),i=0,j=e.vertical;if(d||(d=f),h.length>1&&(h=a(e.items,c)),e.size>1&&(e.circular=!1),a.extend(f,{getConf:function(){return e;},getIndex:function(){return i;},getSize:function(){return f.getItems().size();},getNaviButtons:function(){return n.add(o);},getRoot:function(){return c;},getItemWrap:function(){return h;},getItems:function(){return h.find(e.item).not("."+e.clonedClass);},move:function(a,b){return f.seekTo(i+a,b);},next:function(a){return f.move(e.size,a);},prev:function(a){return f.move(-e.size,a);},begin:function(a){return f.seekTo(0,a);},end:function(a){return f.seekTo(f.getSize()-1,a);},focus:function(){return d=f,f;},addItem:function(b){return b=a(b),e.circular?(h.children().last().before(b),h.children().first().replaceWith(b.clone().addClass(e.clonedClass))):(h.append(b),o.removeClass("disabled")),g.trigger("onAddItem",[b]),f;},seekTo:function(b,c,k){if(b.jquery||(b*=1),e.circular&&0===b&&-1==i&&0!==c)return f;if(!e.circular&&0>b||b>f.getSize()||-1>b)return f;var l=b;b.jquery?b=f.getItems().index(b):l=f.getItems().eq(b);var m=a.Event("onBeforeSeek");if(!k&&(g.trigger(m,[b,c]),m.isDefaultPrevented()||!l.length))return f;var n=j?{top:-l.position().top}:{left:-l.position().left};return i=b,d=f,void 0===c&&(c=e.speed),h.animate(n,c,e.easing,k||function(){g.trigger("onSeek",[b]);}),f;}}),a.each(["onBeforeSeek","onSeek","onAddItem"],function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){return b&&a(f).on(c,b),f;};}),e.circular){var k=f.getItems().slice(-1).clone().prependTo(h),l=f.getItems().eq(1).clone().appendTo(h);k.add(l).addClass(e.clonedClass),f.onBeforeSeek(function(a,b,c){return a.isDefaultPrevented()?void 0:-1==b?(f.seekTo(k,c,function(){f.end(0);}),a.preventDefault()):void (b==f.getSize()&&f.seekTo(l,c,function(){f.begin(0);}));});var m=c.parents().add(c).filter(function(){return "none"===a(this).css("display")?!0:void 0;});m.length?(m.show(),f.seekTo(0,0,function(){}),m.hide()):f.seekTo(0,0,function(){});}var n=b(c,e.prev).click(function(a){a.stopPropagation(),f.prev();}),o=b(c,e.next).click(function(a){a.stopPropagation(),f.next();});if(e.circular||(f.onBeforeSeek(function(a,b){setTimeout(function(){a.isDefaultPrevented()||(n.toggleClass(e.disabledClass,0>=b),o.toggleClass(e.disabledClass,b>=f.getSize()-1));},1);}),e.initialIndex||n.addClass(e.disabledClass)),f.getSize()<2&&n.add(o).addClass(e.disabledClass),e.mousewheel&&a.fn.mousewheel&&c.mousewheel(function(a,b){return e.mousewheel?(f.move(0>b?1:-1,e.wheelSpeed||50),!1):void 0;}),e.touch){var p={};h[0].ontouchstart=function(a){var b=a.touches[0];p.x=b.clientX,p.y=b.clientY;},h[0].ontouchmove=function(a){if(1==a.touches.length&&!h.is(":animated")){var b=a.touches[0],c=p.x-b.clientX,d=p.y-b.clientY;f[j&&d>0||!j&&c>0?"next":"prev"](),a.preventDefault();}};}e.keyboard&&a(document).on("keydown.scrollable",function(b){if(!(!e.keyboard||b.altKey||b.ctrlKey||b.metaKey||a(b.target).is(":input")||"static"!=e.keyboard&&d!=f)){var c=b.keyCode;return !j||38!=c&&40!=c?j||37!=c&&39!=c?void 0:(f.move(37==c?-1:1),b.preventDefault()):(f.move(38==c?-1:1),b.preventDefault());}}),e.initialIndex&&f.seekTo(e.initialIndex,0,function(){});}a.tools=a.tools||{version:"@VERSION"},a.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var d;a.fn.scrollable=function(b){var d=this.data("scrollable");return d?d:(b=a.extend({},a.tools.scrollable.conf,b),this.each(function(){d=new c(a(this),b),a(this).data("scrollable",d);}),b.api?d:this);};}(jQuery),function(a){function b(b,c,d){var f,g=this,h=b.add(this),i=b.find(d.tabs),j=c.jquery?c:b.children(c);i.length||(i=b.children()),j.length||(j=b.parent().find(c)),j.length||(j=a(c)),a.extend(this,{click:function(c,j){var k=i.eq(c),l=!b.data("tabs");if("string"==typeof c&&c.replace("#","")&&(k=i.filter('[href*="'+c.replace("#","")+'"]'),c=Math.max(i.index(k),0)),d.rotate){var m=i.length-1;if(0>c)return g.click(m,j);if(c>m)return g.click(0,j);}if(!k.length){if(f>=0)return g;c=d.initialIndex,k=i.eq(c);}if(c===f)return g;if(j=j||a.Event(),j.type="onBeforeClick",h.trigger(j,[c]),!j.isDefaultPrevented()){var n=l?d.initialEffect&&d.effect||"default":d.effect;return e[n].call(g,c,function(){f=c,j.type="onClick",h.trigger(j,[c]);}),i.removeClass(d.current),k.addClass(d.current),g;}},getConf:function(){return d;},getTabs:function(){return i;},getPanes:function(){return j;},getCurrentPane:function(){return j.eq(f);},getCurrentTab:function(){return i.eq(f);},getIndex:function(){return f;},next:function(){return g.click(f+1);},prev:function(){return g.click(f-1);},destroy:function(){return i.off(d.event).removeClass(d.current),j.find('a[href^="#"]').off("click.T"),g;}}),a.each("onBeforeClick,onClick".split(","),function(b,c){a.isFunction(d[c])&&a(g).on(c,d[c]),g[c]=function(b){return b&&a(g).on(c,b),g;};}),d.history&&a.fn.history&&(a.tools.history.init(i),d.event="history"),i.each(function(b){a(this).on(d.event,function(a){return g.click(b,a),a.preventDefault();});}),j.find('a[href^="#"]').on("click.T",function(b){g.click(a(this).attr("href"),b);}),location.hash&&"a"==d.tabs&&b.find('[href="'+location.hash+'"]').length?g.click(location.hash):(0===d.initialIndex||d.initialIndex>0)&&g.click(d.initialIndex);}a.tools=a.tools||{version:"@VERSION"},a.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialEffect:!1,initialIndex:0,event:"click",rotate:!1,slideUpSpeed:400,slideDownSpeed:400,history:!1},addEffect:function(a,b){e[a]=b;}};var c,d,e={"default":function(a,b){this.getPanes().hide().eq(a).show(),b.call();},fade:function(a,b){var c=this.getConf(),d=c.fadeOutSpeed,e=this.getPanes();d?e.fadeOut(d):e.hide(),e.eq(a).fadeIn(c.fadeInSpeed,b);},slide:function(a,b){var c=this.getConf();this.getPanes().slideUp(c.slideUpSpeed),this.getPanes().eq(a).slideDown(c.slideDownSpeed,b);},ajax:function(a,b){this.getPanes().eq(0).load(this.getTabs().eq(a).attr("href"),b);}};a.tools.tabs.addEffect("horizontal",function(b,e){if(!c){var f=this.getPanes().eq(b),g=this.getCurrentPane();d||(d=this.getPanes().eq(0).width()),c=!0,f.show(),g.animate({width:0},{step:function(a){f.css("width",d-a);},complete:function(){a(this).hide(),e.call(),c=!1;}}),g.length||(e.call(),c=!1);}}),a.fn.tabs=function(c,d){var e=this.data("tabs");return e&&(e.destroy(),this.removeData("tabs")),a.isFunction(d)&&(d={onBeforeClick:d}),d=a.extend({},a.tools.tabs.conf,d),this.each(function(){e=new b(a(this),c,d),a(this).data("tabs",e);}),d.api?e:this;};}(jQuery),function(a){function b(a){if(a){var b=d.contentWindow.document;b.open().close(),b.location.hash=a;}}var c,d,e,f;a.tools=a.tools||{version:"@VERSION"},a.tools.history={init:function(g){f||(a.browser.msie&&a.browser.version<"8"?d||(d=a("<iframe/>").attr("src","javascript:false;").hide().get(0),a("body").append(d),setInterval(function(){var b=d.contentWindow.document,e=b.location.hash;c!==e&&a(window).trigger("hash",e);},100),b(location.hash||"#")):setInterval(function(){var b=location.hash;b!==c&&a(window).trigger("hash",b);},100),e=e?e.add(g):g,g.click(function(c){var e=a(this).attr("href");return d&&b(e),"#"!=e.slice(0,1)?(location.href="#"+e,c.preventDefault()):void 0;}),f=!0);}},a(window).on("hash",function(b,d){d?e.filter(function(){var b=a(this).attr("href");return b==d||b==d.replace("#","");}).trigger("history",[d]):e.eq(0).trigger("history",[d]),c=d;}),a.fn.history=function(b){return a.tools.history.init(this),this.on("history",b);};}(jQuery),function(a){function b(){if(/msie/.test(navigator.userAgent.toLowerCase())){var b=a(document).height(),c=a(window).height();return [window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,20>b-c?c:b];}return [a(document).width(),a(document).height()];}function c(b){return b?b.call(a.mask):void 0;}a.tools=a.tools||{version:"@VERSION"};var d;d=a.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};var e,f,g,h,i;a.mask={load:function(j,k){if(g)return this;"string"==typeof j&&(j={color:j}),j=j||h,h=j=a.extend(a.extend({},d.conf),j),e=a("#"+j.maskId),e.length||(e=a("<div/>").attr("id",j.maskId),a("body").append(e));var l=b();return e.css({position:"absolute",top:0,left:0,width:l[0],height:l[1],display:"none",opacity:j.startOpacity,zIndex:j.zIndex}),j.color&&e.css("backgroundColor",j.color),c(j.onBeforeLoad)===!1?this:(j.closeOnEsc&&a(document).on("keydown.mask",function(b){27==b.keyCode&&a.mask.close(b);}),j.closeOnClick&&e.on("click.mask",function(b){a.mask.close(b);}),a(window).on("resize.mask",function(){a.mask.fit();}),k&&k.length&&(i=k.eq(0).css("zIndex"),a.each(k,function(){var b=a(this);/relative|absolute|fixed/i.test(b.css("position"))||b.css("position","relative");}),f=k.css({zIndex:Math.max(j.zIndex+1,"auto"==i?0:i)})),e.css({display:"block"}).fadeTo(j.loadSpeed,j.opacity,function(){a.mask.fit(),c(j.onLoad),g="full";}),g=!0,this);},close:function(){if(g){if(c(h.onBeforeClose)===!1)return this;e.fadeOut(h.closeSpeed,function(){f&&f.css({zIndex:i}),g=!1,c(h.onClose);}),a(document).off("keydown.mask"),e.off("click.mask"),a(window).off("resize.mask");}return this;},fit:function(){if(g){var a=b();e.css({width:a[0],height:a[1]});}},getMask:function(){return e;},isLoaded:function(a){return a?"full"==g:g;},getConf:function(){return h;},getExposed:function(){return f;}},a.fn.mask=function(b){return a.mask.load(b),this;},a.fn.expose=function(b){return a.mask.load(b,this),this;};}(jQuery),function(a){function b(b,c,d){var e=d.relative?b.position().top:b.offset().top,f=d.relative?b.position().left:b.offset().left,g=d.position[0];e-=c.outerHeight()-d.offset[0],f+=b.outerWidth()+d.offset[1],/iPad/i.test(navigator.userAgent)&&(e-=a(window).scrollTop());var h=c.outerHeight()+b.outerHeight();"center"==g&&(e+=h/2),"bottom"==g&&(e+=h),g=d.position[1];var i=c.outerWidth()+b.outerWidth();return "center"==g&&(f-=i/2),"left"==g&&(f-=i),{top:e,left:f};}function c(c,e){var f,g,h=this,i=c.add(h),j=0,k=0,l=c.attr("title"),m=c.attr("data-tooltip"),n=d[e.effect],o=c.is(":input"),p=o&&c.is(":checkbox, :radio, select, :button, :submit"),q=c.attr("type"),r=e.events[q]||e.events[o?p?"widget":"input":"def"];if(!n)throw 'Nonexistent effect "'+e.effect+'"';if(r=r.split(/,\s*/),2!=r.length)throw "Tooltip: bad events configuration for "+q;c.on(r[0],function(a){clearTimeout(j),e.predelay?k=setTimeout(function(){h.show(a);},e.predelay):h.show(a);}).on(r[1],function(a){clearTimeout(k),e.delay?j=setTimeout(function(){h.hide(a);},e.delay):h.hide(a);}),l&&e.cancelDefault&&(c.removeAttr("title"),c.data("title",l)),a.extend(h,{show:function(d){if(!f&&(m?f=a(m):e.tip?f=a(e.tip).eq(0):l?f=a(e.layout).addClass(e.tipClass).appendTo(document.body).hide().append(l):(f=c.find("."+e.tipClass),f.length||(f=c.next()),f.length||(f=c.parent().next())),!f.length))throw "Cannot find tooltip for "+c;if(h.isShown())return h;f.stop(!0,!0);var o=b(c,f,e);if(e.tip&&f.html(c.data("title")),d=a.Event(),d.type="onBeforeShow",i.trigger(d,[o]),d.isDefaultPrevented())return h;o=b(c,f,e),f.css({position:"absolute",top:o.top,left:o.left}),g=!0,n[0].call(h,function(){d.type="onShow",g="full",i.trigger(d);});var p=e.events.tooltip.split(/,\s*/);return f.data("__set")||(f.off(p[0]).on(p[0],function(){clearTimeout(j),clearTimeout(k);}),p[1]&&!c.is("input:not(:checkbox, :radio), textarea")&&f.off(p[1]).on(p[1],function(a){a.relatedTarget!=c[0]&&c.trigger(r[1].split(" ")[0]);}),e.tip||f.data("__set",!0)),h;},hide:function(b){return f&&h.isShown()?(b=a.Event(),b.type="onBeforeHide",i.trigger(b),b.isDefaultPrevented()?void 0:(g=!1,d[e.effect][1].call(h,function(){b.type="onHide",i.trigger(b);}),h)):h;},isShown:function(a){return a?"full"==g:g;},getConf:function(){return e;},getTip:function(){return f;},getTrigger:function(){return c;}}),a.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(b,c){a.isFunction(e[c])&&a(h).on(c,e[c]),h[c]=function(b){return b&&a(h).on(c,b),h;};});}a.tools=a.tools||{version:"@VERSION"},a.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(a,b,c){d[a]=[b,c];}};var d={toggle:[function(a){var b=this.getConf(),c=this.getTip(),d=b.opacity;1>d&&c.css({opacity:d}),c.show(),a.call();},function(a){this.getTip().hide(),a.call();}],fade:[function(a){var b=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||b.fadeIE?this.getTip().fadeTo(b.fadeInSpeed,b.opacity,a):(this.getTip().show(),a());},function(a){var b=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||b.fadeIE?this.getTip().fadeOut(b.fadeOutSpeed,a):(this.getTip().hide(),a());}]};a.fn.tooltip=function(b){var d=this.data("tooltip");return d?d:(b=a.extend(!0,{},a.tools.tooltip.conf,b),"string"==typeof b.position&&(b.position=b.position.split(/,?\s/)),this.each(function(){d=new c(a(this),b),a(this).data("tooltip",d);}),b.api?d:this);};}(jQuery);var a={};a.fileapi=$("<input type='file'/>").get(0).files!==undefined;a.formdata=window.FormData!==undefined;var b=!!$.fn.prop;$.fn.attr2=function(){if(!b)return this.attr.apply(this,arguments);var a=this.prop.apply(this,arguments);if((a&&a.jquery)||typeof a==='string')return a;return this.attr.apply(this,arguments);};$.fn.ajaxSubmit=function(c){if(!this.length){e('ajaxSubmit: skipping submit process - no element selected');return this;}var d,f,g,h=this;if(typeof c=='function')c={success:c};else if(c===undefined)c={};d=c.type||this.attr2('method');f=c.url||this.attr2('action');g=(typeof f==='string')?$.trim(f):'';g=g||window.location.href||'';if(g)g=(g.match(/^([^#]+)/)||[])[1];c=$.extend(true,{url:g,success:$.ajaxSettings.success,type:d||$.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},c);var i={};this.trigger('form-pre-serialize',[this,c,i]);if(i.veto){e('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}if(c.beforeSerialize&&c.beforeSerialize(this,c)===false){e('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}var j=c.traditional;if(j===undefined)j=$.ajaxSettings.traditional;var k=[];var l,m=this.formToArray(c.semantic,k);if(c.data){c.extraData=c.data;l=$.param(c.data,j);}if(c.beforeSubmit&&c.beforeSubmit(m,this,c)===false){e('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}this.trigger('form-submit-validate',[m,this,c,i]);if(i.veto){e('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}var n=$.param(m,j);if(l)n=(n?(n+'&'+l):l);if(c.type.toUpperCase()=='GET'){c.url+=(c.url.indexOf('?')>=0?'&':'?')+n;c.data=null;}else c.data=n;var o=[];if(c.resetForm)o.push(function(){h.resetForm();});if(c.clearForm)o.push(function(){h.clearForm(c.includeHidden);});if(!c.dataType&&c.target){var p=c.success||function(){};o.push(function(a){var b=c.replaceTarget?'replaceWith':'html';$(c.target)[b](a).each(p,arguments);});}else if(c.success)o.push(c.success);c.success=function(a,b,d){var e=c.context||this;for(var f=0,g=o.length;f<g;f++)o[f].apply(e,[a,b,d||h,h]);};if(c.error){var q=c.error;c.error=function(a,b,d){var e=c.context||this;q.apply(e,[a,b,d,h]);};}if(c.complete){var r=c.complete;c.complete=function(a,b){var d=c.context||this;r.apply(d,[a,b,h]);};}var s=$('input[type=file]:enabled',this).filter(function(){return $(this).val()!=='';});var t=s.length>0;var u='multipart/form-data';var v=(h.attr('enctype')==u||h.attr('encoding')==u);var w=a.fileapi&&a.formdata;e("fileAPI :"+w);var x=(t||v)&&!w;var y;if(c.iframe!==false&&(c.iframe||x))if(c.closeKeepAlive)$.get(c.closeKeepAlive,function(){y=C(m);});else y=C(m);else if((t||v)&&w)y=B(m);else y=$.ajax(c);h.removeData('jqxhr').data('jqxhr',y);for(var z=0;z<k.length;z++)k[z]=null;this.trigger('form-submit-notify',[this,c]);return this;function A(a){var b=$.param(a,c.traditional).split('&');var d=b.length;var e=[];var f,g;for(f=0;f<d;f++){b[f]=b[f].replace(/\+/g,' ');g=b[f].split('=');e.push([decodeURIComponent(g[0]),decodeURIComponent(g[1])]);}return e;}function B(a){var b=new FormData();for(var e=0;e<a.length;e++)b.append(a[e].name,a[e].value);if(c.extraData){var f=A(c.extraData);for(e=0;e<f.length;e++)if(f[e])b.append(f[e][0],f[e][1]);}c.data=null;var g=$.extend(true,{},$.ajaxSettings,c,{contentType:false,processData:false,cache:false,type:d||'POST'});if(c.uploadProgress)g.xhr=function(){var a=$.ajaxSettings.xhr();if(a.upload)a.upload.addEventListener('progress',function(a){var b=0;var d=a.loaded||a.position;var e=a.total;if(a.lengthComputable)b=Math.ceil(d/e*100);c.uploadProgress(a,d,e,b);},false);return a;};g.data=null;var h=g.beforeSend;g.beforeSend=function(a,d){if(c.formData)d.data=c.formData;else d.data=b;if(h)h.call(this,a,d);};return $.ajax(g);}function C(a){var f=h[0],g,i,j,l,m,n,o,p,q,r,s,t;var u=$.Deferred();u.abort=function(a){p.abort(a);};if(a)for(i=0;i<k.length;i++){g=$(k[i]);if(b)g.prop('disabled',false);else g.removeAttr('disabled');}j=$.extend(true,{},$.ajaxSettings,c);j.context=j.context||j;m='jqFormIO'+(new Date().getTime());if(j.iframeTarget){n=$(j.iframeTarget);r=n.attr2('name');if(!r)n.attr2('name',m);else m=r;}else{n=$('<iframe name="'+m+'" src="'+j.iframeSrc+'" />');n.css({position:'absolute',top:'-1000px',left:'-1000px'});}o=n[0];p={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(a){var b=(a==='timeout'?'timeout':'aborted');e('aborting upload... '+b);this.aborted=1;try{if(o.contentWindow.document.execCommand)o.contentWindow.document.execCommand('Stop');}catch(c){}n.attr('src',j.iframeSrc);p.error=b;if(j.error)j.error.call(j.context,p,b,a);if(l)$.event.trigger("ajaxError",[p,j,b]);if(j.complete)j.complete.call(j.context,p,b);}};l=j.global;if(l&&0===$.active++)$.event.trigger("ajaxStart");if(l)$.event.trigger("ajaxSend",[p,j]);if(j.beforeSend&&j.beforeSend.call(j.context,p,j)===false){if(j.global)$.active--;u.reject();return u;}if(p.aborted){u.reject();return u;}q=f.clk;if(q){r=q.name;if(r&&!q.disabled){j.extraData=j.extraData||{};j.extraData[r]=q.value;if(q.type=="image"){j.extraData[r+'.x']=f.clk_x;j.extraData[r+'.y']=f.clk_y;}}}var v=1;var w=2;function x(a){var b=null;try{if(a.contentWindow)b=a.contentWindow.document;}catch(c){e('cannot get iframe.contentWindow document: '+c);}if(b)return b;try{b=a.contentDocument?a.contentDocument:a.document;}catch(c){e('cannot get iframe.contentDocument: '+c);b=a.document;}return b;}var y=$('meta[name=csrf-token]').attr('content');var z=$('meta[name=csrf-param]').attr('content');if(z&&y){j.extraData=j.extraData||{};j.extraData[z]=y;}function A(){var a=h.attr2('target'),b=h.attr2('action'),c='multipart/form-data',g=h.attr('enctype')||h.attr('encoding')||c;f.setAttribute('target',m);if(!d||/post/i.test(d))f.setAttribute('method','POST');if(b!=j.url)f.setAttribute('action',j.url);if(!j.skipEncodingOverride&&(!d||/post/i.test(d)))h.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});if(j.timeout)t=setTimeout(function(){s=true;F(v);},j.timeout);function i(){try{var a=x(o).readyState;e('state = '+a);if(a&&a.toLowerCase()=='uninitialized')setTimeout(i,50);}catch(b){e('Server abort: ',b,' (',b.name,')');F(w);if(t)clearTimeout(t);t=undefined;}}var k=[];try{if(j.extraData)for(var l in j.extraData)if(j.extraData.hasOwnProperty(l))if($.isPlainObject(j.extraData[l])&&j.extraData[l].hasOwnProperty('name')&&j.extraData[l].hasOwnProperty('value'))k.push($('<input type="hidden" name="'+j.extraData[l].name+'">').val(j.extraData[l].value).appendTo(f)[0]);else k.push($('<input type="hidden" name="'+l+'">').val(j.extraData[l]).appendTo(f)[0]);if(!j.iframeTarget)n.appendTo('body');if(o.attachEvent)o.attachEvent('onload',F);else o.addEventListener('load',F,false);setTimeout(i,15);try{f.submit();}catch(p){var q=document.createElement('form').submit;q.apply(f);}}finally{f.setAttribute('action',b);f.setAttribute('enctype',g);if(a)f.setAttribute('target',a);else h.removeAttr('target');$(k).remove();}}if(j.forceSync)A();else setTimeout(A,10);var B,C,D=50,E;function F(a){if(p.aborted||E)return;C=x(o);if(!C){e('cannot access response document');a=w;}if(a===v&&p){p.abort('timeout');u.reject(p,'timeout');return;}else if(a==w&&p){p.abort('server abort');u.reject(p,'error','server abort');return;}if(!C||C.location.href==j.iframeSrc)if(!s)return;if(o.detachEvent)o.detachEvent('onload',F);else o.removeEventListener('load',F,false);var b='success',c;try{if(s)throw 'timeout';var d=j.dataType=='xml'||C.XMLDocument||$.isXMLDoc(C);e('isXml='+d);if(!d&&window.opera&&(C.body===null||!C.body.innerHTML))if(--D){e('requeing onLoad callback, DOM not available');setTimeout(F,250);return;}var f=C.body?C.body:C.documentElement;p.responseText=f?f.innerHTML:null;p.responseXML=C.XMLDocument?C.XMLDocument:C;if(d)j.dataType='xml';p.getResponseHeader=function(a){var b={'content-type':j.dataType};return b[a.toLowerCase()];};if(f){p.status=Number(f.getAttribute('status'))||p.status;p.statusText=f.getAttribute('statusText')||p.statusText;}var g=(j.dataType||'').toLowerCase();var h=/(json|script|text)/.test(g);if(h||j.textarea){var i=C.getElementsByTagName('textarea')[0];if(i){p.responseText=i.value;p.status=Number(i.getAttribute('status'))||p.status;p.statusText=i.getAttribute('statusText')||p.statusText;}else if(h){var k=C.getElementsByTagName('pre')[0];var m=C.getElementsByTagName('body')[0];if(k)p.responseText=k.textContent?k.textContent:k.innerText;else if(m)p.responseText=m.textContent?m.textContent:m.innerText;}}else if(g=='xml'&&!p.responseXML&&p.responseText)p.responseXML=G(p.responseText);try{B=I(p,g,j);}catch(q){b='parsererror';p.error=c=(q||b);}}catch(q){e('error caught: ',q);b='error';p.error=c=(q||b);}if(p.aborted){e('upload aborted');b=null;}if(p.status)b=(p.status>=200&&p.status<300||p.status===304)?'success':'error';if(b==='success'){if(j.success)j.success.call(j.context,B,'success',p);u.resolve(p.responseText,'success',p);if(l)$.event.trigger("ajaxSuccess",[p,j]);}else if(b){if(c===undefined)c=p.statusText;if(j.error)j.error.call(j.context,p,b,c);u.reject(p,'error',c);if(l)$.event.trigger("ajaxError",[p,j,c]);}if(l)$.event.trigger("ajaxComplete",[p,j]);if(l&&!--$.active)$.event.trigger("ajaxStop");if(j.complete)j.complete.call(j.context,p,b);E=true;if(j.timeout)clearTimeout(t);setTimeout(function(){if(!j.iframeTarget)n.remove();else n.attr('src',j.iframeSrc);p.responseXML=null;},100);}var G=$.parseXML||function(a,b){if(window.ActiveXObject){b=new ActiveXObject('Microsoft.XMLDOM');b.async='false';b.loadXML(a);}else b=new DOMParser().parseFromString(a,'text/xml');return(b&&b.documentElement&&b.documentElement.nodeName!='parsererror')?b:null;};var H=$.parseJSON||function(a){return window.eval('('+a+')');};var I=function(a,b,c){var d=a.getResponseHeader('content-type')||'',e=b==='xml'||!b&&d.indexOf('xml')>=0,f=e?a.responseXML:a.responseText;if(e&&f.documentElement.nodeName==='parsererror')if($.error)$.error('parsererror');if(c&&c.dataFilter)f=c.dataFilter(f,b);if(typeof f==='string')if(b==='json'||!b&&d.indexOf('json')>=0)f=H(f);else if(b==="script"||!b&&d.indexOf("javascript")>=0)$.globalEval(f);return f;};return u;}};$.fn.ajaxForm=function(a){a=a||{};a.delegation=a.delegation&&$.isFunction($.fn.on);if(!a.delegation&&this.length===0){var b={s:this.selector,c:this.context};if(!$.isReady&&b.s){e('DOM not ready, queuing ajaxForm');$(function(){$(b.s,b.c).ajaxForm(a);});return this;}e('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this;}if(a.delegation){$(document).off('submit.form-plugin',this.selector,c).off('click.form-plugin',this.selector,d).on('submit.form-plugin',this.selector,a,c).on('click.form-plugin',this.selector,a,d);return this;}return this.ajaxFormUnbind().bind('submit.form-plugin',a,c).bind('click.form-plugin',a,d);};function c(a){var b=a.data;if(!a.isDefaultPrevented()){a.preventDefault();$(a.target).ajaxSubmit(b);}}function d(a){var b=a.target;var c=$(b);if(!(c.is("[type=submit],[type=image]"))){var d=c.closest('[type=submit]');if(d.length===0)return;b=d[0];}var e=this;e.clk=b;if(b.type=='image')if(a.offsetX!==undefined){e.clk_x=a.offsetX;e.clk_y=a.offsetY;}else if(typeof $.fn.offset=='function'){var f=c.offset();e.clk_x=a.pageX-f.left;e.clk_y=a.pageY-f.top;}else{e.clk_x=a.pageX-b.offsetLeft;e.clk_y=a.pageY-b.offsetTop;}setTimeout(function(){e.clk=e.clk_x=e.clk_y=null;},100);}$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(b,c){var d=[];if(this.length===0)return d;var e=this[0];var f=this.attr('id');var g=b?e.getElementsByTagName('*'):e.elements;var h;if(g&&!/MSIE [678]/.test(navigator.userAgent))g=$(g).get();if(f){h=$(':input[form="'+f+'"]').get();if(h.length)g=(g||[]).concat(h);}if(!g||!g.length)return d;var i,j,k,l,m,n,o;for(i=0,n=g.length;i<n;i++){m=g[i];k=m.name;if(!k||m.disabled)continue;if(b&&e.clk&&m.type=="image"){if(e.clk==m){d.push({name:k,value:$(m).val(),type:m.type});d.push({name:k+'.x',value:e.clk_x},{name:k+'.y',value:e.clk_y});}continue;}l=$.fieldValue(m,true);if(l&&l.constructor==Array){if(c)c.push(m);for(j=0,o=l.length;j<o;j++)d.push({name:k,value:l[j]});}else if(a.fileapi&&m.type=='file'){if(c)c.push(m);var p=m.files;if(p.length)for(j=0;j<p.length;j++)d.push({name:k,value:p[j],type:m.type});else d.push({name:k,value:'',type:m.type});}else if(l!==null&&typeof l!='undefined'){if(c)c.push(m);d.push({name:k,value:l,type:m.type,required:m.required});}}if(!b&&e.clk){var q=$(e.clk),r=q[0];k=r.name;if(k&&!r.disabled&&r.type=='image'){d.push({name:k,value:q.val()});d.push({name:k+'.x',value:e.clk_x},{name:k+'.y',value:e.clk_y});}}return d;};$.fn.formSerialize=function(a){return $.param(this.formToArray(a));};$.fn.fieldSerialize=function(a){var b=[];this.each(function(){var c=this.name;if(!c)return;var d=$.fieldValue(this,a);if(d&&d.constructor==Array)for(var e=0,f=d.length;e<f;e++)b.push({name:c,value:d[e]});else if(d!==null&&typeof d!='undefined')b.push({name:this.name,value:d});});return $.param(b);};$.fn.fieldValue=function(a){for(var b=[],c=0,d=this.length;c<d;c++){var e=this[c];var f=$.fieldValue(e,a);if(f===null||typeof f=='undefined'||(f.constructor==Array&&!f.length))continue;if(f.constructor==Array)$.merge(b,f);else b.push(f);}return b;};$.fieldValue=function(a,b){var c=a.name,d=a.type,e=a.tagName.toLowerCase();if(b===undefined)b=true;if(b&&(!c||a.disabled||d=='reset'||d=='button'||(d=='checkbox'||d=='radio')&&!a.checked||(d=='submit'||d=='image')&&a.form&&a.form.clk!=a||e=='select'&&a.selectedIndex==-1))return null;if(e=='select'){var f=a.selectedIndex;if(f<0)return null;var g=[],h=a.options;var i=(d=='select-one');var j=(i?f+1:h.length);for(var k=(i?f:0);k<j;k++){var l=h[k];if(l.selected){var m=l.value;if(!m)m=(l.attributes&&l.attributes.value&&!(l.attributes.value.specified))?l.text:l.value;if(i)return m;g.push(m);}}return g;}return $(a).val();};$.fn.clearForm=function(a){return this.each(function(){$('input,select,textarea',this).clearFields(a);});};$.fn.clearFields=$.fn.clearInputs=function(a){var b=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var c=this.type,d=this.tagName.toLowerCase();if(b.test(c)||d=='textarea')this.value='';else if(c=='checkbox'||c=='radio')this.checked=false;else if(d=='select')this.selectedIndex=-1;else if(c=="file")if(/MSIE/.test(navigator.userAgent))$(this).replaceWith($(this).clone(true));else $(this).val('');else if(a)if((a===true&&/hidden/.test(c))||(typeof a=='string'&&$(this).is(a)))this.value='';});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType))this.reset();});};$.fn.enable=function(a){if(a===undefined)a=true;return this.each(function(){this.disabled=!a;});};$.fn.selected=function(a){if(a===undefined)a=true;return this.each(function(){var b=this.type;if(b=='checkbox'||b=='radio')this.checked=a;else if(this.tagName.toLowerCase()=='option'){var c=$(this).parent('select');if(a&&c[0]&&c[0].type=='select-one')c.find('option').selected(false);this.selected=a;}});};$.fn.ajaxSubmit.debug=false;function e(){if(!$.fn.ajaxSubmit.debug)return;var a='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log)window.console.log(a);else if(window.opera&&window.opera.postError)window.opera.postError(a);}var f={spinner:{},overlay_counter:1};jQuery.tools.overlay.conf.oneInstance=false;(function(a){jQuery.tools.overlay.addEffect('default',function(b,c){var d=this.getConf(),e=a(window),f=this.getOverlay(),g=f.parent().offsetParent().offset();if(!d.fixed){b.top+=e.scrollTop()-g.top;b.left+=e.scrollLeft()-g.left;}b.position=d.fixed?'fixed':'absolute';f.css(b).fadeIn(d.speed,c);},function(a){this.getOverlay().fadeOut(this.getConf().closeSpeed,a);});f.spinner.show=function(){a('body').css('cursor','wait');};f.spinner.hide=function(){a('body').css('cursor','');};}(jQuery));jQuery(function(a){a.fn.prepOverlay=function(b){return this.each(function(){var c,d,e,g,h,i,j;c=a(this);d=a.extend(true,{'width':'60%'},b);e=d.config||{};g=f[d.subtype];if(g)e.onBeforeLoad=g;h=e.onLoad;e.onLoad=function(){if(h)h.apply(this,arguments);f.fi_focus(this.getOverlay());};i=c.attr('href')||c.attr('src')||c.attr('action');if(d.urlmatch)i=i.replace(new RegExp(d.urlmatch),d.urlreplace);if(d.subtype==='inline'){i=i.replace(/^.+#/,'#');a("[id='"+i.replace('#','')+"']").addClass('overlay');c.removeAttr('href').attr('rel',i);c.overlay();}else{d.nt='pb_'+f.overlay_counter;f.overlay_counter+=1;d.selector=d.filter||d.selector;if(!d.selector){j=i.split(' ');i=j.shift();d.selector=j.join(' ');}d.src=i;d.config=e;d.source=c;f.remove_overlay(c);c.data('pbo',d);c.attr('rel','#'+d.nt);c.addClass('link-overlay');switch(d.subtype){case 'image':c.click(f.image_click);break;case 'ajax':c.click(f.ajax_click);break;case 'iframe':f.create_content_div(d);c.overlay(e);break;default:throw "Unsupported overlay type";}c.css('cursor','pointer');}});};f.remove_overlay=function(b){var c=b.data('pbo');if(c){switch(c.subtype){case 'image':b.unbind('click',f.image_click);break;case 'ajax':b.unbind('click',f.ajax_click);break;default:b.unbind('click');break;}if(c.nt)a('#'+c.nt).remove();}};f.create_content_div=function(b,c){var d,e,f=b.width;if(typeof close_box_message==='undefined')e='Close this box.';else e=close_box_message;d=a('<div id="'+b.nt+'" class="overlay overlay-'+b.subtype+' '+(b.cssclass||'')+'"><div class="close"><a href="#" class="hiddenStructure" title="Close this box">'+e+'</a></div></div>');d.data('pbo',b);if(f)if(f.indexOf('%')>0)d.width(parseInt(f,10)/100*a(window).width());else d.width(f);d.appendTo(a("body"));return d;};f.image_click=function(b){var c,d,e,g,h,i;c=a(this);i=c.data('pbo');d=a(c.attr('rel'));if(!d.length){d=f.create_content_div(i);d.overlay(i.config);}e=d.overlay();if(d.find('img').length===0){if(i.src){f.spinner.show();g=new Image();g.src=i.src;h=a(g);d.append(h.addClass('pb-image'));h.load(function(){f.spinner.hide();e.load();});}}else e.load();return false;};f.fi_focus=function(a){if(!a.find("form div.error :input:first").focus().length)a.find("form :input:visible:first").focus();};f.ajax_error_recover=function(b,c){var d=a('<div/>').append(b.replace(/<script(.|\s)*?\/script>/gi,""));return c?d.find(c):d;};f.add_ajax_load=function(b){if(b.find('input[name=ajax_load]').length===0)b.prepend(a('<input type="hidden" name="ajax_load" value="'+(new Date().getTime())+'" />'));};f.prep_ajax_form=function(b){var c=b.closest('.pb-ajax'),d=c.closest('.overlay-ajax'),e=d.data('pbo'),g=e.formselector,h=e.closeselector,i=e.beforepost,j=e.afterpost,k=e.noform,l=d.overlay(),m=e.selector,n={};n.beforeSerialize=function(){f.spinner.show();};if(i)n.beforeSubmit=function(a,b,c){return i(b,a,c);};n.success=function(b,i,o,p){a(document).trigger('formOverlayStart',[this,b,i,o,p]);var q,r,s,t,u=[],v;s=i==="success"||i==="notmodified";if(!s)b=b.responseText;v=b.replace(/<script(.|\s)*?\/script>/gi,"");q=a('<div />').append(m?a('<div />').append(v).find(m):v);if(s&&j)j(q,d);r=q.find(g);if(s&&r.length){c.empty().append(q);try{a.buildFragment([b],[document],u);}catch(w){a.buildFragment([b],document,u);}if(u.length)a.each(u,function(){a.globalEval(this.text||this.textContent||this.innerHTML||"");});if(a.fn.ploneTabInit)q.ploneTabInit();f.fi_focus(c);f.add_ajax_load(r);r.ajaxForm(n);if(h)q.find(h).click(function(a){l.close();return false;});a(document).trigger('formOverlayLoadSuccess',[this,r,l,f,c]);}else{if(s){if(typeof k==="function")k=k(q,e);}else k=i;switch(k){case 'close':l.close();break;case 'reload':l.close();f.spinner.show();location.replace(location.href);break;case 'redirect':l.close();f.spinner.show();t=e.redirect;if(typeof t==="function")t=t(q,b,e);location.replace(t);break;default:if(q.children())c.empty().append(q);else l.close();break;}a(document).trigger('formOverlayLoadFailure',[this,r,l,f,c,k]);}f.spinner.hide();};n.error=n.success;f.add_ajax_load(b);b.ajaxForm(n);};f.ajax_click=function(b){var c=a(this),d,e,g,h,i,j,k,m,n,o=[],p;p=a.Event();p.type="beforeAjaxClickHandled";a(document).trigger(p,[this,b]);if(p.isDefaultPrevented())return false;d=c.data('pbo');e=f.create_content_div(d,c);e.overlay(d.config,c);g=e.overlay();h=d.src;j=d.selector;k=d.formselector;m=d.closeselector;f.spinner.show();a(this).find("input.submitting").removeClass('submitting');i=a('div.pb-ajax',e);if(i.length===0){i=a('<div class="pb-ajax" />');e.append(i);}if(g.getConf().fixed)i.css('max-height',Math.floor(a(window).height()*0.75));n=(h.indexOf('?')>=0)?'&':'?';h+=n+"ajax_load="+(new Date().getTime());if(j)h+=' '+j;i[0].handle_load_inside_overlay=function(b,c){var d,h;d=a(this);if(c==='error')d.append(f.ajax_error_recover(b,j));else if(!b.length)d.append(l||'No response from server.');d.wrapInner('<div />');if(k){h=d.find(k);if(h.length>0)f.prep_ajax_form(h);}if(m)d.find(m).click(function(a){g.close();return false;});try{a.buildFragment([b],[document],o);}catch(i){a.buildFragment([b],document,o);}if(o.length)a.each(o,function(){a.globalEval(this.text||this.textContent||this.innerHTML||"");});if(a.fn.ploneTabInit)d.ploneTabInit();g.onClose=function(){e.remove();};a(document).trigger('loadInsideOverlay',[this,b,c,g]);};i.load(h,null,function(a,b){i[0].handle_load_inside_overlay.apply(this,[a,b]);f.spinner.hide();g.load();return true;});return false;};f.iframe=function(){var a,b;f.spinner.show();a=this.getOverlay();b=this.getTrigger().data('pbo');if(a.find('iframe').length===0&&b.src)a.append('<iframe src="'+b.src+'" width="'+a.width()+'" height="'+a.height()+'" onload="pb.spinner.hide()"/>');else f.spinner.hide();return true;};});jQuery(function(a){var b,c,d,e,f=a('#search-results'),g=a('#search-filter'),h=a('#search-field'),i=a('#searchGadget'),j=a("form.searchPage"),k=a('link[rel="home"]').attr('href')||window.navigation_root_url||window.portal_url;a.fn.pullSearchResults=function(b){return this.each(function(){var c=a(this);a.get('@@updated_search',b,function(d){c.hide();var e=a('<div id="ajax-search-res"></div>').html(d),f=a('#search-term');var g=e.find('#search-results').children(),h=e.find('#updated-search-term').text(),i=e.find('#updated-search-results-number').text(),j=e.find('#updated-sorting-options').html(),l=e.find('#update-search-header');c.html(g);c.fadeIn();if(!f.length){if(l.length)a('h1.documentFirstHeading').html(l.html());}else f.text(h);a('#search-results-number').text(i);a('#search-results-bar').find('#sorting-options').html(j);a('#rss-subscription').find('a.link-feed').attr('href',function(){return k+'/search_rss?'+b;});});});};c=function(a){if(Modernizr.history){var b=k+'/@@search?'+a;history.pushState(null,null,b);}};d=(window.history&&'state' in window.history);e=location.href;a(window).bind('popstate',function(c){var g,j;g=!d&&location.href===e;d=true;if(g)return;if(!location.search)return;b=location.search.split('?')[1];var k=b.match(/SearchableText=[^&]*/);if(k){j=k[0];j=decodeURIComponent(j.replace(/\+/g,' '));a.merge(h.find('input[name="SearchableText"]'),i).val(j.substr(15,j.length));f.pullSearchResults(b);}});g.find('input.searchPage[type="submit"]').hide();h.find('input.searchButton').click(function(b){var d,e=location.search.substring(1),g=/([^&=]+)=([^&]*)/g,i,j=[],k;d=h.find('input[name="SearchableText"]').val();j.push({"name":"SearchableText","value":d});while(i=g.exec(e)){k=decodeURIComponent(i[1]);if(k!=='SearchableText')j.push({"name":k,"value":decodeURIComponent(i[2].replace(/\+/g,' '))});}e=a.param(j);f.pullSearchResults(e);c(e);b.preventDefault();});j.submit(function(d){b=a(this).serialize();f.pullSearchResults(b);c(b);d.preventDefault();});h.find('input[name="SearchableText"]').keyup(function(){i.val(a(this).val());});a('#search-results-bar').find('dl.actionMenu > dd.actionMenuContent').click(function(a){a.stopImmediatePropagation();});g.delegate('input, select','change',function(a){b='';if(g.find('input:checked').length>1)b=j.serialize();f.pullSearchResults(b);c(b);});a('#sorting-options').delegate('a','click',function(d){if(a(this).attr('data-sort'))j.find("input[name='sort_on']").val(a(this).attr('data-sort'));else j.find("input[name='sort_on']").val('');b=this.search.split('?')[1];f.pullSearchResults(b);c(b);d.preventDefault();});f.delegate('.listingBar a','click',function(a){b=this.search.split('?')[1];f.pullSearchResults(b);c(b);a.preventDefault();});});var g='http://localhost:8080/Plone';var h='No s\'ha desat el formulari. Tots els canvis que heu fet es perdran.';var i='Ja heu clicat el botó d\'enviar. Voleu tornar a enviar el formulari un altre cop?';var j='false';var k='false';var l='No hi ha resposta des del servidor. Torneu-ho a provar més tard.';(function(a){var b,c,d,e;b=function(b){a.extend(this,b);this.terms=this.cleanTerms(this.terms.length?this.terms:this.getSearchTerms());};b.prototype={highlight:function(b){if(!this.terms.length||!b.length)return;var c=this;a.each(this.terms,function(a,d){b.find('*:not(textarea)').andSelf().contents().each(function(){if(this.nodeType===3)c.highlightTermInNode(this,d);});});},highlightTermInNode:function(b,c){var d=b.nodeValue,e=this,f,g,h,i;if(a(b).parent().hasClass(e.highlightClass))return;f=function(b){return a('<span class="'+e.highlightClass+'">&nbsp;</span>').text(b);};g=e.caseInsensitive;while(d&&(h=(g?d.toLowerCase():d).indexOf(c))>-1){a(b).before(document.createTextNode(d.substr(0,h))).before(f(d.substr(h,c.length))).before(document.createTextNode(d.substr(h+c.length)));i=b.previousSibling;a(b).remove();b=i;d=b.nodeValue;}},queryStringValue:function(a,b){var c,d;if(a.indexOf('?')<0)return '';a=a.substr(a.indexOf('?')+1);while(a.indexOf('=')>=0){a=a.replace(/^\&*/,'');d=a.split('&',1)[0];a=a.substr(d.length);c=d.match(b);if(c)return decodeURIComponent(c[c.length-1].replace(/\+/g,' '));}return '';},termsFromReferrer:function(){var b,c,d;b=a.fn.highlightSearchTerms._test_referrer!==null?a.fn.highlightSearchTerms._test_referrer:document.referrer;if(!b)return '';for(c=0;c<this.referrers.length;c+=1){d=this.referrers[c];if(b.match(d.address))return this.queryStringValue(b,d.key);}return '';},cleanTerms:function(b){var c=this;return a.unique(a.map(b,function(b){b=a.trim(c.caseInsensitive?b.toLowerCase():b);return(!b||c.filterTerms.test(b))?null:b;}));},getSearchTerms:function(){var b=[],c=a.fn.highlightSearchTerms._test_location!==null?a.fn.highlightSearchTerms._test_location:location.href;if(this.useReferrer)a.merge(b,this.termsFromReferrer().split(/\s+/));if(this.useLocation)a.merge(b,this.queryStringValue(c,this.searchKey).split(/\s+/));return b;}};c=function(a){return(typeof a==='string')?new RegExp('^'+a+'=(.*)$','i'):a;};d=function(a){return(typeof a==='string')?new RegExp('^https?://(www\\.)?'+a,'i'):a;};a.fn.highlightSearchTerms=function(f){f=a.extend({},e,f);f=a.extend(f,{searchKey:c(f.searchKey),referrers:a.map(f.referrers,function(a){return{address:d(a.address),key:c(a.key)};})});if(f.includeOwnDomain){var g=a.fn.highlightSearchTerms._test_location!==null?a.fn.highlightSearchTerms._test_location:location.hostname;f.referrers.push({address:d(g.replace(/\./g,'\\.')),key:f.searchKey});}new b(f).highlight(this);return this;};a.fn.highlightSearchTerms.referrers=[{address:'google\\.',key:'q'},{address:'search\\.yahoo\\.',key:'p'},{address:'search\\.msn\\.',key:'q'},{address:'search\\.live\\.',key:'query'},{address:'search\\.aol\\.',key:'userQuery'},{address:'ask\\.com',key:'q'},{address:'altavista\\.',key:'q'},{address:'feedster\\.',key:'q'}];e={terms:[],useLocation:true,searchKey:'(searchterm|SearchableText)',useReferrer:true,referrers:a.fn.highlightSearchTerms.referrers,includeOwnDomain:true,caseInsensitive:true,filterTerms:/(not|and|or)/i,highlightClass:'highlightedSearchTerm'};a.fn.highlightSearchTerms._test_location=null;a.fn.highlightSearchTerms._test_referrer=null;a.fn.highlightSearchTerms._highlighter=b;}(jQuery));jQuery(function(a){a('#region-content,#content').highlightSearchTerms({includeOwnDomain:a('dl.searchResults').length===0});});if(m===undefined)var m={};(function(a,b){b.paevent=b.paevent||{};b.paevent.end_start_delta=1/24;function c(a,b){var c;if(a.length>0)c=a;else c=b;return c;}function d(b){var c,d,e;c=a('input[name="_submit"]:first',b).prop('value');c=c.split("-");d=a('input[name="_submit"]:last',b).prop('value')||'00:00';d=d.split(":");e=new Date(parseInt(c[0],10),parseInt(c[1],10)-1,parseInt(c[2],10),parseInt(d[0],10),parseInt(d[1],10));return e;}function e(){var e,f;e=d(c(a('#formfield-form-widgets-IEventBasic-start'),a('#archetypes-fieldname-startDate')));f=d(c(a('#formfield-form-widgets-IEventBasic-end'),a('#archetypes-fieldname-endDate')));b.paevent.end_start_delta=(f-e)/1000/60;}function f(){var e,f,g,h;e=c(a('#formfield-form-widgets-IEventBasic-start'),a('#archetypes-fieldname-startDate'));f=c(a('#formfield-form-widgets-IEventBasic-end'),a('#archetypes-fieldname-endDate'));g=d(e);h=new Date(g);h.setMinutes(g.getMinutes()+b.paevent.end_start_delta);a('.pattern-pickadate-date',f).pickadate('picker').set('select',h);a('.pattern-pickadate-time',f).pickatime('picker').set('select',h);}function g(){var b,e,f,g;b=c(a('#formfield-form-widgets-IEventBasic-start'),a('#archetypes-fieldname-startDate'));e=c(a('#formfield-form-widgets-IEventBasic-end'),a('#archetypes-fieldname-endDate'));f=d(b);g=d(e);if(g<f)e.addClass("error");else e.removeClass("error");}function h(b,c,d){var e=a(b);if(c===true)if(d===true)e.fadeOut();else e.hide();else if(d===true)e.fadeIn();else e.show();}function i(b){if(a().dateinput&&b.length>0){var c,d;c=function(a){if(a===new RegExp('[?&]'+encodeURIComponent(a)+'=([^&]*)').exec(window.location.search))return decodeURIComponent(a[1]);};d=c('date');if(d===undefined)d=new Date();else d=new Date(d);b.dateinput({selectors:true,trigger:true,format:'yyyy-mm-dd',yearRange:[-10,10],firstDay:1,value:d,change:function(){var a=this.getValue("yyyy-mm-dd");window.location.href='event_listing?mode=day&date='+a;}}).unbind('change').bind('onShow',function(){var b=a(this).next().offset();a(this).data('dateinput').getCalendar().offset({top:b.top+20,left:b.left});});}}a(window).load(function(){var b,d,j,k,l;b=c(a('#formfield-form-widgets-IEventBasic-whole_day input'),a('form[name="edit_form"] input#wholeDay'));d=c(a('#formfield-form-widgets-IEventBasic-start .pattern-pickadate-time-wrapper, #formfield-form-widgets-IEventBasic-end .pattern-pickadate-time-wrapper'),a('#archetypes-fieldname-startDate .pattern-pickadate-time-wrapper, #archetypes-fieldname-endDate .pattern-pickadate-time-wrapper'));if(b.length>0){b.bind('change',function(a){h(d,a.target.checked,true);});h(d,b.get(0).checked,false);}j=c(a('#formfield-form-widgets-IEventBasic-open_end input'),a('form[name="edit_form"] input#openEnd'));k=c(a('#formfield-form-widgets-IEventBasic-end'),a('#archetypes-fieldname-endDate'));if(j.length>0){j.bind('change',function(a){h(k,a.target.checked,true);});h(k,j.get(0).checked,false);}l=c(a('#formfield-form-widgets-IEventBasic-start'),a('#archetypes-fieldname-startDate'));l.each(function(){a(this).on('focus','.picker__input',e);a(this).on('change','.picker__input',f);});k.each(function(){a(this).on('focus','.picker__input',e);a(this).on('change','.picker__input',g);});i(a("#event_listing_calendar"));});}(jQuery,m));(function(a){function b(b,d){b.preventDefault();var e,f,h,i;e=d.closest('.portletWrapper');f=d.data();h=e.attr('id');h=h.substring(15,h.length);i=g+'/@@render-portlet?portlethash='+h+'&year='+f.year+'&month='+f.month;a.ajax({url:i,success:function(a){e.html(a);c();}});}function c(){a('.portletCalendar a.calendarNext').click(function(c){b(c,a(this));});a('.portletCalendar a.calendarPrevious').click(function(c){b(c,a(this));});a('.portletCalendar dd a[title]').tooltip({offset:[-10,0],tipClass:'pae_calendar_tooltip'});}a(document).ready(function(){c();});}(jQuery));(function(a){a.createReplyForm=function(b){var c=b.attr("id");var d=b.find(".reply-to-comment-button");var e=a("#commenting").clone(true);e.find("#formfield-form-widgets-captcha").find("script").remove();e.appendTo(b).css("display","none");e.removeAttr("id");a(d).css("display","none");var f=e.find("form");f.find('#formfield-form-widgets-comment-text').attr('id','formfield-form-widgets-new-textarea'+c);f.find('#form-widgets-comment-text').attr('id','form-widgets-new-textarea'+c);f.find("input[name='form.widgets.in_reply_to']").val(c);var g=e.find(".cancelreplytocomment");g.attr("id",c);f.find("input[name='form.buttons.cancel']").css("display","inline");e.slideDown("slow");g.css("display","inline");};a.clearForm=function(a){a.find(".error").removeClass("error");a.find(".fieldErrorBox").remove();a.find("input[type='text']").attr("value","");a.find("textarea").attr("value","");};a(window).load(function(){var b=a("#commenting");var c=b.find("input[name='form.widgets.in_reply_to']");if(c.length!==0&&c.val()!==""){var d="#"+c.val();var e=a(".discussion").find(d);a.createReplyForm(e);a.clearForm(b);}a(".reply-to-comment-button").bind("click",function(b){var c=a(this).parents().filter(".comment");a.createReplyForm(c);a.clearForm(c);});a("#commenting #form-buttons-cancel").bind("click",function(b){b.preventDefault();var c=a(this).parents().filter(".comment").find(".reply-to-comment-button");a.reply_to_comment_form=a(this).parents().filter(".reply");a.reply_to_comment_form.slideUp("slow",function(){a(this).remove();});c.css("display","inline");});a("input[name='form.button.PublishComment']").on('click',function(){var b=this;var c=a(this).parents("form");var d=a(c).serialize();var e=a(c).attr("action");a.ajax({type:"GET",url:e,data:d,context:b,success:function(a){c.find("input[name='form.button.PublishComment']").remove();c.parents(".state-pending").toggleClass('state-pending').toggleClass('state-published');},error:function(a){return true;}});return false;});a("form[name='edit']").prepOverlay({cssclass:'overlay-edit-comment',width:'60%',subtype:'ajax',filter:'#content>*'});a("input[name='form.button.DeleteComment']").on('click',function(){var b=this;var c=a(this).parents("form");var d=a(c).serialize();var e=a(c).attr("action");a.ajax({type:'POST',url:e,data:d,context:a(b).parents(".comment"),success:function(b){var c=a(this);var d=c.attr('class');var e=parseInt(d[d.indexOf('replyTreeLevel')+'replyTreeLevel'.length],10);var f=".replyTreeLevel"+e;for(var g=0;g<e;g++)f+=", .replyTreeLevel"+g;c.nextUntil(f).each(function(){a(this).fadeOut('fast',function(){a(this).remove();});});a(this).fadeOut('fast',function(){a(this).remove();});},error:function(a,b){return true;}});return false;});a(".reply").find("input[name='form.buttons.reply']").css("display","none");a(".reply").find("input[name='form.buttons.cancel']").css("display","none");a(".reply-to-comment-button").css("display","inline");});}(jQuery));